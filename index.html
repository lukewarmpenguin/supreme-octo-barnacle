<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Nestling Contraction Counter</title>
  <meta name="application-name" content="Nestling Contraction Counter">

  <!-- PWA Manifest & Icons -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <meta name="theme-color" content="#0a0b1e" />

  <!-- Tailwind (CDN is fine for now) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Pixel font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- Confetti (app.js calls window.confetti) -->
  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <!-- Base styles (single style block) -->
 <style>
  :root{
    --bg:#0a0b1e; --fg:#e6f7ff;
    --glass:rgba(255,255,255,.06); --glass-border:rgba(255,255,255,.14);
    --btn-a:#3b82f6; --btn-b:#a855f7;
  }

  html,body{background:var(--bg);color:var(--fg);min-height:100%;}
  .pixel{font-family:'Press Start 2P',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
  .glass{background:var(--glass);border:1px solid var(--glass-border);backdrop-filter:blur(8px);border-radius:1rem;}
  .hist-card{border-radius:.75rem;border:1px solid var(--glass-border);background:rgba(255,255,255,.04);padding:.75rem .9rem;}
  .hist-meta{font-size:.75rem;opacity:.8}

  /* Header */
  .title-wrap{
    font-size: clamp(1.1rem, 4.5vw, 1.75rem);
    line-height: 1.15;
    margin: 0;
    white-space: normal;
    text-wrap: balance;
  }
  .neon-text{
    color:#22d3ee;
    text-shadow:
      0 0 1px rgba(255,255,255,.9),
      0 0 4px rgba(34,211,238,.9),
      0 0 8px rgba(34,211,238,.5);
  }
  .tagline{
    font-size: clamp(.7rem, 2vw, .8rem);
    letter-spacing:.18em;
    text-transform:uppercase;
    color: rgba(244,114,182,.9);
    margin-top:.35rem;
  }
  @keyframes logo-pulse {
    0%,100% { filter: drop-shadow(0 0 6px rgba(34,211,238,.5)); }
    50%     { filter: drop-shadow(0 0 12px rgba(34,211,238,.9)); }
  }
  .logo-glow { animation: logo-pulse 3s infinite ease-in-out; }

  /* Big One-Tap button (base) */
  #bigTap{position:relative;isolation:isolate;width:15rem;height:15rem;border-radius:9999px;}
  @media (max-width:380px){#bigTap{width:14rem;height:14rem}}
  #bigTap::before{
    content:"";position:absolute;inset:0;border-radius:inherit;z-index:1;
    background:
      radial-gradient(80% 80% at 30% 25%, rgba(255,255,255,.18), transparent 60%),
      linear-gradient(135deg, var(--btn-a), var(--btn-b));
  }
  #bigTap::after{
    content:"";position:absolute;inset:-3px;border-radius:inherit;z-index:0;
    box-shadow:0 0 24px rgba(34,211,238,.35),
               0 0 46px rgba(217,70,239,.35),
               inset 0 0 22px rgba(255,255,255,.12);
  }

  /* High-contrast ring flash (color-blind friendly) */
  @keyframes ringPulse {
    0%   { box-shadow: 0 0 0 0 rgba(255,255,255,.85), 0 0 22px rgba(255,255,255,.35); }
    100% { box-shadow: 0 0 0 10px rgba(255,255,255,0), 0 0 8px rgba(255,255,255,.15); }
  }
  .ring-ok, .ring-warn { position: relative; }
  .ring-ok::after, .ring-warn::after{
    content:"";position:absolute;inset:-6px;border-radius:9999px;pointer-events:none;
    animation: ringPulse 900ms ease-out forwards;
    outline:3px solid rgba(255,255,255,.9); outline-offset:3px;
  }
  .ring-ok::after   { box-shadow:0 0 0 0 rgba(34,197,94,.9); }   /* green tint */
  .ring-warn::after { box-shadow:0 0 0 0 rgba(245,158,11,.95); } /* amber tint */

  /* Help modal entrance */
  #helpModal:not(.hidden) .glass{animation:modalPop .22s ease-out both;}
  @keyframes modalPop{0%{transform:translateY(-6px) scale(.98);opacity:0}100%{transform:translateY(0) scale(1);opacity:1}}

  /* Modal text normalization */
  .help { font-size:.95rem;color:rgba(255,255,255,.92); }
  .help ul ul { font-size:.9em; }
</style>
</head>
<body class="min-h-screen">
  <!-- Header -->
<header class="relative mb-4 pt-7">
  <!-- Help Modal Trigger -->
<button id="openHelp"
  class="absolute top-2 left-2 text-sm text-white/80 bg-white/10 hover:bg-white/20 border border-white/30 rounded-full w-7 h-7 flex items-center justify-center shadow-md backdrop-blur-sm transition">
  ?
</button>
  <!-- Logo in the top-right -->
  <img
    src="./images/lukewarmpenguin-logo.png?v=2"
    alt="Lukewarmpenguin Logo"
    class="absolute top-0 right-0 w-14 h-14 rounded-full logo-glow hover:scale-105 transition-transform"
  />

  <!-- Centered, wrapping title + tagline -->
  <div class="text-center px-16">
    <!-- px-16 pads left/right so the logo doesn't overlap on tiny screens -->
    <h1 class="pixel neon-text title-wrap">
      Nestling Contraction Counter
    </h1>
    <p class="tagline">
      A Lukewarmpenguin Project
    </p>
  </div>
</header>
  <!-- Main card -->
  <main class="px-4">
    <section class="glass p-4 md:p-6">
      <!-- Elapsed timer -->
 <div class="text-center mb-4">
  <div class="text-sm opacity-80">Elapsed</div>
  <div id="elElapsed" class="pixel text-xl">00:00</div>
  <div id="currentMeta" class="text-xs opacity-70 mt-1"></div>
</div>

      <!-- Big one-tap button -->
      <div class="flex justify-center mb-4">
        <button id="bigTap" class="relative isolate">
          <div class="relative z-10 h-full w-full flex flex-col items-center justify-center">
            <span class="text-[10px] opacity-90 uppercase tracking-[0.35em]">One-Tap</span>
            <span id="bigTapLabel" class="pixel text-[0.9rem] mt-1">Start Contraction</span>
            <span class="hist-meta mt-1">Ends current & starts new</span>
          </div>
        </button>
      </div>

      <!-- Controls -->
      <div class="flex items-center justify-center gap-2 flex-wrap">
        <button id="btnEnd" class="px-3 py-2 rounded-md border border-white/20 bg-white/10 hover:bg-white/15">End Current</button>
        <button id="btnCsv" class="px-3 py-2 rounded-md border border-white/20 bg-white/10 hover:bg-white/15">Export CSV</button>
        <button id="btnReset" class="px-3 py-2 rounded-md border border-white/20 bg-white/10 hover:bg-white/15">Reset All</button>
        <!-- Temp test button (optional) -->
        <!-- <button id="force511" class="px-2 py-1 text-xs rounded-md border border-white/20 bg-white/10 hover:bg-white/15">Force 5-1-1</button> -->
      </div>
    </section>

    <!-- History -->
    <section class="mt-4">
      <ul id="rows" class="space-y-2">
        <!-- app.js will render history items here -->
      </ul>
    </section>
  </main>

<!-- HELP MODAL -->
<div id="helpModal" class="fixed inset-0 hidden z-40">
  <div id="helpBackdrop" class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>

  <div class="absolute inset-x-4 top-16 md:inset-x-0 md:top-24 md:mx-auto md:max-w-md glass pt-7 pb-5 px-5 rounded-xl border border-white/20 shadow-lg help">
    <div class="flex items-center justify-between mb-3">
      <div class="pixel text-cyan-300 text-lg drop-shadow">How to use Nestling CC</div>
      <button id="closeHelp"
        class="px-2 py-1 rounded-md bg-white/10 border border-white/20 hover:bg-white/15 transition">Close</button>
    </div>

    <ul class="space-y-3 leading-6">
      <li>• Tap <strong>One-Tap</strong> to start timing a contraction.</li>
      <li>• Tap again when the contraction ends — the app automatically starts the <strong>Rest</strong> period.</li>
      <li>• Tap once more when the next contraction begins — that ends the rest and starts a new cycle.</li>
      <li>• The main button will briefly flash:
        <ul class="ml-6 list-disc mt-1">
          <li><span class="text-green-400 font-semibold">Green</span> if the contraction lasted ≥ 1 minute</li>
          <li><span class="text-yellow-300 font-semibold">Yellow</span> if it lasted &lt; 1 minute</li>
        </ul>
      </li>
      <li>• When contractions follow the <strong>5-1-1</strong> pattern for an hour, you’ll see the <strong>BABY INCOMING!</strong> alert with confetti.</li>
      <li>• Use <strong>Export CSV</strong> to save or share your timing history.</li>
    </ul>
  </div>
</div>

  <!-- Scripts LAST (after modal + UI exist) -->
  <script src="app.js"></script>
  <script>
    // Auto-updating service worker (no manual version bumps)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').catch(console.error);
      });
    }
  </script>
  <!-- TEMP: force alert button (for testing only) -->
<button id="force511"
  class="fixed left-4 bottom-4 z-50 text-xs font-mono px-2 py-1 rounded bg-white/15 border border-white/25 text-white hover:bg-white/25">
  Force 5-1-1
</button>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Neo Contraction Tracker</title>

  <!-- PWA Manifest & Icons -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <meta name="theme-color" content="#0a0b1e" />

  <!-- Tailwind (CDN is fine for now) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Pixel font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- Confetti (app.js calls window.confetti) -->
  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <!-- Base styles (single style block) -->
  <style>
    :root{
      --bg:#0a0b1e; --fg:#e6f7ff;
      --glass:rgba(255,255,255,.06); --glass-border:rgba(255,255,255,.14);
      --btn-a:#3b82f6; --btn-b:#a855f7;
    }
    html,body{background:var(--bg);color:var(--fg);min-height:100%;}
    .pixel{font-family:'Press Start 2P',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
    .title-pixel{font-size:1rem;}
    @media (min-width:480px){.title-pixel{font-size:1.25rem}}
    @media (min-width:768px){.title-pixel{font-size:1.5rem}}

    .glass{background:var(--glass);border:1px solid var(--glass-border);backdrop-filter:blur(8px);border-radius:1rem;}

    /* Big button & glow */
    #bigTap{position:relative;isolation:isolate;width:15rem;height:15rem;border-radius:9999px;}
    @media (max-width:380px){#bigTap{width:14rem;height:14rem}}
    #bigTap::before{
      content:"";position:absolute;inset:0;border-radius:inherit;z-index:1;
      background:
        radial-gradient(80% 80% at 30% 25%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(135deg, var(--btn-a), var(--btn-b));
    }
    #bigTap::after{
      content:"";position:absolute;inset:-3px;border-radius:inherit;z-index:0;
      box-shadow:0 0 24px rgba(34,211,238,.35),0 0 46px rgba(217,70,239,.35),inset 0 0 22px rgba(255,255,255,.12);
    }
    #bigTap.flash-ok::after,#bigTap.flash-warn::after{
      content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;opacity:1;z-index:60;
    }
    #bigTap.flash-ok::after{
      background:radial-gradient(ellipse at center, rgba(34,197,94,.35), rgba(34,197,94,.20) 60%, rgba(34,197,94,.10) 80%, transparent 100%);
      box-shadow:0 0 30px rgba(34,197,94,.55), inset 0 0 18px rgba(34,197,94,.45);
    }
    #bigTap.flash-warn::after{
      background:radial-gradient(ellipse at center, rgba(234,179,8,.40), rgba(234,179,8,.22) 60%, rgba(234,179,8,.12) 80%, transparent 100%);
      box-shadow:0 0 30px rgba(234,179,8,.55), inset 0 0 18px rgba(234,179,8,.45);
    }

    /* Help modal entrance */
    #helpModal:not(.hidden) .glass{animation:modalPop .22s ease-out both;}
    @keyframes modalPop{0%{transform:translateY(-6px) scale(.98);opacity:0}100%{transform:translateY(0) scale(1);opacity:1}}

    /* Simple list styling */
    .hist-card{border-radius:.75rem;border:1px solid var(--glass-border);background:rgba(255,255,255,.04);padding:.75rem .9rem;}
    .hist-meta{font-size:.75rem;opacity:.8}
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="mt-6 mb-6 flex items-center justify-between px-4">
    <h1 class="pixel title-pixel font-black uppercase tracking-wide drop-shadow-[0_0_12px_rgba(0,255,255,0.35)]">
      Neo Contraction Tracker
    </h1>
    <button id="openHelp" aria-label="How to use"
      class="px-3 py-2 rounded-full border border-white/20 bg-white/10 hover:bg-white/15 active:bg-white/20">
      <span class="pixel" style="font-size:.9rem">?</span>
    </button>
  </header>

  <!-- Main card -->
  <main class="px-4">
    <section class="glass p-4 md:p-6">
      <!-- Elapsed timer -->
 <div class="text-center mb-4">
  <div class="text-sm opacity-80">Elapsed</div>
  <div id="elElapsed" class="pixel text-xl">00:00</div>
  <div id="currentMeta" class="text-xs opacity-70 mt-1"></div>
</div>

      <!-- Big one-tap button -->
      <div class="flex justify-center mb-4">
        <button id="bigTap" class="relative isolate">
          <div class="relative z-10 h-full w-full flex flex-col items-center justify-center">
            <span class="text-[10px] opacity-90 uppercase tracking-[0.35em]">One-Tap</span>
            <span id="bigTapLabel" class="pixel text-[0.9rem] mt-1">Start Contraction</span>
            <span class="hist-meta mt-1">Ends current & starts new</span>
          </div>
        </button>
      </div>

      <!-- Controls -->
      <div class="flex items-center justify-center gap-2 flex-wrap">
        <button id="btnEnd" class="px-3 py-2 rounded-md border border-white/20 bg-white/10 hover:bg-white/15">End Current</button>
        <button id="btnCsv" class="px-3 py-2 rounded-md border border-white/20 bg-white/10 hover:bg-white/15">Export CSV</button>
        <button id="btnReset" class="px-3 py-2 rounded-md border border-white/20 bg-white/10 hover:bg-white/15">Reset All</button>
        <!-- Temp test button (optional) -->
        <!-- <button id="force511" class="px-2 py-1 text-xs rounded-md border border-white/20 bg-white/10 hover:bg-white/15">Force 5-1-1</button> -->
      </div>
    </section>

    <!-- History -->
    <section class="mt-4">
      <ul id="rows" class="space-y-2">
        <!-- app.js will render history items here -->
      </ul>
    </section>
  </main>

  <!-- HELP MODAL -->
  <div id="helpModal" class="fixed inset-0 hidden z-40">
    <div id="helpBackdrop" class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
    <div class="absolute inset-x-4 top-16 md:inset-x-0 md:top-24 md:mx-auto md:max-w-md glass p-5">
      <div class="flex items-center justify-between mb-3">
        <div class="pixel" style="font-size:1rem">How to use Neo CT</div>
        <button id="closeHelp" class="px-2 py-1 rounded-md bg-white/10 border border-white/20 hover:bg-white/15">Close</button>
      </div>
      <ol class="space-y-2 text-sm leading-6 opacity-90">
        <li>• Tap <span class="pixel">One-Tap</span> at the <b>start</b> of each contraction.</li>
        <li>• Each tap <b>ends</b> the last one and <b>starts</b> a new one automatically.</li>
        <li>• Use <span class="pixel">End Current</span> only if a contraction stops and you’re not immediately starting the next.</li>
        <li>• Button flashes <b>green</b> for ≥1:00, <b>yellow</b> for &lt;1:00.</li>
        <li>• <span class="pixel">Export CSV</span> to share timing with your provider.</li>
      </ol>
    </div>
  </div>

  <!-- Scripts LAST (after modal + UI exist) -->
  <script src="app.js"></script>
  <script>
    // Auto-updating service worker (no manual version bumps)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
